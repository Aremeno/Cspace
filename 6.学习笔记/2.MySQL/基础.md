#  MySQL与SQL的学习

## 数据库的基本概念

- 数据库（Database）：用于存储和管理数据的系统。
- 数据库管理系统（DBMS）：用于创建、管理和操作数据库的软件。
- SQL（Structured Query Language）：操作关系型数据库的编程语言，定义了一套操作数据库的标准语法。

**SQL**最重要，数据库其实是其次的，因为SQL是操作数据库的语言。

## MySQL数据模型

### 关系型数据库（Relational Database）

建立在关系模型基础上，由多张相互连接的二维表组成的数据库。

### 数据模型

由客户端与服务器端组成，客户端发送SQL语句到服务器端，DBMS解析并执行SQL语句，指定的数据存储在数据库中。

## SQL通用语法及分类

1. SQL语句可以单行书写，也可以多行书写，以分号结尾。
2. SQL语句可以使用空格或缩进来提高可读性。
3. SQL语句不区分大小写，但为了提高可读性，通常将关键字大写。
4. 注释：
   - 单行注释：`-- 注释内容`
   - 多行注释：`/* 注释内容 */`

### 常用SQL语句分类

- 数据定义语言（DDL）：用于定义和管理数据库结构的语句，如`CREATE`、`ALTER`、`DROP`等。
- 数据操作语言（DML）：用于操作数据的语句，如`INSERT`、`UPDATE`、`DELETE`等。
- 数据控制语言（DCL）：用于控制数据库访问权限的语句，如`GRANT`、`REVOKE`等。
- 数据查询语言（DQL）：用于查询数据的语句，如`SELECT`。

#### DDL语句-操作数据库

##### 查询库

- 查询所有数据库

  ```sql
  SHOW DATABASES;
  ```

- 查询当前使用的数据库

  ```sql
  SELECT DATABASE();
  ```

##### 创建库

- 创建数据库

    ```sql
    CREATE DATABASE [IF NOT EXISTS] database_name;
    ```

创建数据库命令中可以添加的可选项：

- `IF NOT EXISTS`：如果数据库不存在则创建，避免报错。
- `DEFAULT CHARSET`：指定数据库的默认字符集。
- `COLLATE`：指定数据库的默认排序规则。

##### 删除库

- 删除数据库

    ```sql
    DROP DATABASE [IF EXISTS] database_name;
    ```

##### 使用库

- 选择数据库

    ```sql
    USE database_name;
    ```

#### DDL语句-操作数据表

##### 查询表

- 查询当前数据库中的所有数据表

    ```sql
    SHOW TABLES;
    ```

- 查询表结构

    ```sql
    DESC table_name;
    ```

- 查询创建表的语句

    ```sql
    SHOW CREATE TABLE table_name;
    ```

##### 创建表

- 创建数据表

    ```sql
    CREATE TABLE [IF NOT EXISTS] table_name (
        column1 datatype [comment 字段1注释],
        column2 datatype [comment 字段2注释]
    ) [comment 表注释]；
    ```

###### 数据类型

```table
| 数据类型      | 描述                           | 大小       |
| ------------- | ------------------------------ | ---------- |
| tinyint       | 小整数类型                     | 1字节      |
| smallint      | 小整数类型                     | 2字节      |
| mediumint     | 中等整数类型                   | 3字节      |
| int           | 整数类型                       | 4字节      |
| bigint        | 大整数类型                     | 8字节      |
| float         | 单精度浮点数                   | 4字节      |
| double        | 双精度浮点数                   | 8字节      |
| decimal       | 定点数（固定小数点数）         | 可变       |
| char(n)       | 定长字符串，n为长度              | n字节      |
| varchar(n)    | 变长字符串，n为最大长度          | 1~n字节    |
| tinyblob      | 小型二进制数据                   | 255字节    |
| tinytext      | 小型文本字符串                     | 255字节    |
| blob          | 二进制数据                       | 65,535字节 |
| text          | 文本字符串                       | 65,535字节 |
| date          | 日期类型（YYYY-MM-DD）         | 3字节      |
| datetime      | 日期和时间类型（YYYY-MM-DD HH:MM:SS） | | 8字节      |
| timestamp     | 时间戳类型                     | 4字节      |
| time          | 时间类型（HH:MM:SS）           | 3字节      |
| enum          | 枚举类型                       | 1或2字节   |
| set           | 集合类型                       | 1~8字节    |
```

##### 修改

- 添加字段

    ```sql
    ALTER TABLE table_name ADD column_name datatype [comment 字段注释];
    ```

- 修改数据类型

    ```sql
    ALTER TABLE table_name MODIFY column_name new_datatype;
    ```

- 修改字段名和数据类型

    ```sql
    ALTER TABLE table_name CHANGE old_column_name new_column_name new_datatype;
    ```

- 删除字段

    ```sql
    ALTER TABLE table_name DROP COLUMN column_name;
    ```

- 修改表名

    ```sql
    ALTER TABLE old_table_name RENAME TO new_table_name;
    ```

##### 删除表

- 删除数据表

    ```sql
    DROP TABLE [IF EXISTS] table_name;
    ```
  
- 清空数据表

    ```sql
    TRUNCATE TABLE table_name;
    ```

#### DML语句

DML语句用于操作数据，主要包括插入、更新和删除数据。

##### 添加数据

- 给指定字段添加数据

    ```sql
    INSERT INTO table_name (column1, column2, ...) VALUES (value1, value2, ...);
    ```

- 给所有字段添加数据

    ```sql
    INSERT INTO table_name VALUES (value1, value2, ...);
    ```

- 批量添加数据

    ```sql
    INSERT INTO table_name (column1, column2, ...) VALUES 
    (value1a, value2a, ...),
    (value1b, value2b, ...),
    ...;
    ```

**注意**：插入数据时，字符串类型的值需要用单引号或双引号括起来，数值类型的值不需要引号。

##### 修改数据

- 修改数据

    ```sql
    UPDATE table_name SET column1 = value1, column2 = value2, ... WHERE condition;
    ```

##### 删除数据

- 删除数据

    ```sql
    DELETE FROM table_name WHERE condition;
    ```

#### DQL语句

DQL语句用于查询数据，主要使用`SELECT`语句。

##### 基本查询

- 查询多个字段

    ```sql
    SELECT column1, column2, ... FROM table_name;
    SELECT * FROM table_name; -- 查询所有字段
    ```

- 设置查询别名（非必须）

    ```sql
    SELECT column_name AS alias_name FROM table_name;
    ```

- 去重查询

    ```sql
    SELECT DISTINCT column_name FROM table_name;
    ```

##### 条件查询

- 使用`WHERE`子句进行条件查询

    ```sql
    SELECT column1, column2, ... FROM table_name WHERE condition;
    ```

**条件**：  

- 比较运算符：`=`、`!=`、`>`、`<`、`>=`、`<=`、`between ... and ...`、`in (条件值)`、`like`、`is null`等。
- 逻辑运算符：`AND`、`OR`、`NOT`

like详解：

- `%`：表示任意数量的字符（包括零个字符）。
- `_`：表示单个字符。

    例如：
    
    - `WHERE name LIKE 'A%'`：匹配以"A"开头的所有字符串。
    - `WHERE name LIKE '%son'`：匹配以"son"结尾的所有字符串。
    - `WHERE name LIKE '%an%'`：匹配包含"an"的所有字符串。
    - `WHERE name LIKE 'J_n'`：匹配以"J"开头，第三个字符为"n"的所有三字符字符串，如"Jan"、"Jen"等。

##### 聚合函数

- 常用聚合函数：

    - `COUNT(column_name)`：计算指定列的非NULL值的数量。
    - `SUM(column_name)`：计算指定列的总和。
    - `AVG(column_name)`：计算指定列的平均值。
    - `MAX(column_name)`：返回指定列的最大值。
    - `MIN(column_name)`：返回指定列的最小值。

    ```sql
    SELECT COUNT(column_name) FROM table_name WHERE condition;
    ```

##### 分组查询

- 使用`GROUP BY`子句进行分组查询

    ```sql
    SELECT column1, AGGREGATE_FUNCTION(column2) FROM table_name WHERE condition GROUP BY column1 [HAVING aggregate_condition];
    ```

- `HAVING`子句用于对分组后的结果进行过滤，类似于`WHERE`子句，但作用于分组结果。并且where不能与聚合函数一起使用，而having可以。

执行顺序：`WHERE` -> 聚合函数 -> `HAVING` 

分组之后，查询的字段一般为分组字段和聚合函数，查询其他字段无任何意义。

##### 排序查询

- 使用`ORDER BY`子句进行排序查询

    ```sql
    SELECT 字段列表 FROM table_name ORDER BY column1 排列方式1, column2 排列方式2, ...;
    ```

- 排列方式：`ASC`（升序，默认）或`DESC`（降序）

**注意**：如果是多字段排序，当第一个字段的值相同时，才会根据第二个字段进行排序，依此类推。

##### 分页查询

- 使用`LIMIT`子句进行分页查询

    ```sql
    SELECT 字段列表 FROM table_name LIMIT 起始索引, 数量;
    ```

- 起始索引：从0开始计数，表示查询结果的起始位置。起始索引 = (页码 - 1) * 每页显示数量
- 数量：表示查询结果中要返回的记录数。
- 分页查询是数据库的方言，不同数据库的语法可能有所不同。MySQL使用`LIMIT`，而其他数据库可能使用不同的关键字或语法。

**注意**：`LIMIT`子句位置应放在`ORDER BY`子句之后，如果没有`ORDER BY`，则放在查询语句的最后。

##### 执行顺序

**编写顺序**：`SELECT` -> `FROM` -> `WHERE` -> `GROUP BY` -> `HAVING` -> `ORDER BY` -> `LIMIT`

**执行顺序**：`FROM` -> `WHERE` -> `GROUP BY` -> `HAVING` -> `SELECT` -> `ORDER BY` -> `LIMIT`

#### DCL语句

DCL语句用于控制数据库的访问权限，主要包括授权和撤销权限。

##### 用户管理

- 查询用户

    ```sql
    USE mysql;
    SELECT * FROM user;
    ```

- 创建用户

    ```sql
    CREATE USER '用户名'@'主机名' IDENTIFIED BY '密码';
    ```

- 修改用户密码

    ```sql
    ALTER USER '用户名'@'主机名' IDENTIFIED WITH MYSQL_NATIVE_PASSWORD BY '新密码';
    ```

- 删除用户

    ```sql
    DROP USER '用户名'@'主机名';
    ```

##### 权限管理

- 查询权限

    ```sql
    SHOW GRANTS FOR '用户名'@'主机名';
    ```

- 授权

    ```sql
    GRANT 权限列表 ON 数据库名.表名 TO '用户名'@'主机名';
    ```

- 撤销权限

    ```sql
    REVOKE 权限列表 ON 数据库名.表名 FROM '用户名'@'主机名';
    ```

## 函数

函数就是预定义好的SQL语句，可以直接调用来完成特定的操作。

### 字符串函数

常用字符串函数：

- `CONCAT(str1, str2, ...)`：连接多个字符串。
- `LOWER(str)`：将字符串转换为小写。
- `UPPER(str)`：将字符串转换为大写。
- `LPAD(str, length, padstr)`：用字符串padstr填充字符串str的**左**侧，使其达到指定长度length。
- `RPAD(str, length, padstr)`：用字符串padstr填充字符串str的**右**侧，使其达到指定长度length。
- `TRIM(str)`：去除字符串str两端的空格。
- `SUBSTRING(str, start, length)`：从字符串str的指定位置start开始，提取指定长度length的子字符串。(start从1开始计数)
- `LENGTH(str)`：返回字符串str的字节长度。

操作方式：

```sql
select 函数（参数）；
```

### 数值函数

常见数值函数：

- `ROUND(number, decimals)`：将数字number四舍五入到指定的小数位数decimals。
- `FLOOR(number)`：向下取整。
- `CEIL(number)`：向上取整。
- `ABS(number)`：返回数字number的绝对值。
- `MOD(number1, number2)`：返回number1除以number2的余数。
- `POW(number, exponent)`：返回number的exponent次幂。
- `SQRT(number)`：返回数字number的平方根。
- `RAND()`：返回0到1之间的随机浮点数。

### 日期函数

常见日期函数：

- `NOW()`：返回当前的日期和时间。
- `CURDATE()`：返回当前的日期。
- `CURTIME()`：返回当前的时间。
- `DATE_ADD(date, INTERVAL value unit)`：在日期date上添加指定的时间间隔value（单位unit）。
- `YEAR(date)`：返回日期date的年份部分。
- `MONTH(date)`：返回日期date的月份部分。
- `DAY(date)`：返回日期date的天数部分。
- `DATEDIFF(date1, date2)`：返回两个日期date1和date2之间的天数差。(date1 - date2)

### 流程函数

常见流程函数：

- `IF(condition, true_value, false_value)`：根据条件condition的真假返回不同的值。
- `IFNULL(expression, alt_value)`：如果表达式expression为NULL，则返回替代值alt_value，否则返回expression的值。
- `CASE WHEN condition1 THEN result1 WHEN condition2 THEN result2 ELSE resultN END`：根据多个条件返回不同的结果。（when和then可以有多个）
- `CASE expression WHEN value1 THEN result1 WHEN value2 THEN result2 DEFULT resultN END`：根据表达式的值返回不同的结果。

## 约束

### 概述

1. **概念**：约束是作用于表中字段上的规则，用于限制存储在表中的数据。
2. **目的**：保证数据库中数据的正确、有效性和完整性。
3. **分类**：

| 约束类型       | 描述                                   | 关键字          |
| -------------- | -------------------------------------- | --------------- |
| 非空约束     | 确保字段不能为空                         | NOT NULL        |
| 唯一约束     | 确保字段值在表中唯一                     | UNIQUE          |
| 主键约束     | 主键是唯一标识表中每一行数据的字段，不能重复且不能为空 | PRIMARY KEY     |
| 默认约束   | 为字段指定默认值                         | DEFAULT value   |
| 检查约束 | 限制字段值必须满足特定条件               | CHECK (condition) |
| 外键约束 | 确保字段值必须在另一个表的主键或唯一键中存在 | FOREIGN KEY     |

